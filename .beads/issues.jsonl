{"id":"hv-105","content_hash":"e495f2d3c9605c3629c0aa1fa2411869bb668303944cdea7be0d56ece90b8e01","title":"Phase 1: Core Person Normalization Infrastructure","description":"Restore person normalization system to enable canonical person_id linking across contacts, iMessage, and email documents. This establishes the foundational schema and ingestion pipeline to link all document types to normalized person entities.","design":"**Schema Changes:**\n- Restore people tables that were removed in v2 migration:\n  - `people` table: canonical person records with display_name, given_name, family_name, organization, nicknames, notes, photo_hash\n  - `person_identifiers` table: normalized phone/email with value_canonical (e.g., E.164, lowercase email)\n  - `people_source_map` table: maps external contact IDs to person_id (for contact sync)\n  - `person_addresses` and `person_urls` tables for contact enrichment\n  - `people_conflict_log` for tracking identifier conflicts\n\n- Create new junction table for document-person linking:\n  ```sql\n  CREATE TABLE document_people (\n      doc_id UUID REFERENCES documents(doc_id) ON DELETE CASCADE,\n      person_id UUID REFERENCES people(person_id) ON DELETE CASCADE,\n      role TEXT NOT NULL,\n      PRIMARY KEY (doc_id, person_id)\n  );\n  ```\n\n**Implementation:**\n- Update schema/init.sql to include people tables (add migration script)\n- Wire PeopleRepository.upsert_batch() into gateway /catalog/contacts/ingest endpoint\n- During document ingestion, resolve people identifiers using PeopleResolver\n- Insert into document_people junction table","acceptance_criteria":"- People normalization tables exist in schema\n- document_people junction table exists with proper indexes\n- Contacts ingested via gateway are normalized to person_id using PeopleRepository\n- Documents ingested (iMessage, email) have identifiers resolved to person_id via PeopleResolver\n- document_people table populated during document ingestion\n- Can query all documents for a person via JOIN\n- Can query all people in a document via JOIN\n- Identifier conflicts logged in people_conflict_log table\n- Tests verify normalization and linking across contacts, iMessage, and email","notes":"All acceptance criteria met and changes committed successfully","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-10-29T17:10:56.310228-04:00","updated_at":"2025-10-30T12:26:11.46892-04:00","closed_at":"2025-10-30T12:26:11.468928-04:00"}
