#!/usr/bin/env python3
"""
Script to create test fixtures from real iMessage attributed body data.
This extracts binary data from hex strings and creates test fixtures.
"""

import os
import json
from pathlib import Path

# Test data from the database
test_cases = [
    {
        "name": "simple_message",
        "description": "Simple text message with basic attributed body",
        "hex_data": "040B73747265616D747970656481E803840140848484124E5341747472696275746564537472696E67008484084E534F626A656374008592848484084E53537472696E67019484012B11416C7761797320612070617472696F742086840269490111928484840C4E5344696374696F6E617279009484016901928496961D5F5F6B494D4D657373616765506172744174747269627574654E616D658692848484084E534E756D626572008484074E5356616C7565009484012A84999900868686",
        "expected_text": "Always a patriot"
    },
    {
        "name": "complex_message_with_emoji",
        "description": "Message with emojis and special characters",
        "hex_data": "040B73747265616D747970656481E803840140848484194E534D757461626C6541747472696275746564537472696E67008484124E5341747472696275746564537472696E67008484084E534F626A6563740085928484840F4E534D757461626C65537472696E67018484084E53537472696E67019584012B8193024461696C792051756F72646C65203130320A39EFB88FE283A334EFB88FE283A30A37EFB88FE283A338EFB88FE283A30A71756F72646C652E636F6D0AF09F9FA8E2AC9CE2AC9CE2AC9CE2AC9C20E2AC9CF09F9FA9F09F9FA9E2AC9CE2AC9C0AE2AC9CE2AC9CF09F9FA9E2AC9CE2AC9C20F09F9FA8E2AC9CE2AC9CE2AC9CE2AC9C0AE2AC9CE2AC9CE2AC9CE2AC9CE2AC9C20E2AC9CE2AC9CE2AC9CF09F9FA9E2AC9C0AE2AC9CE2AC9CE2AC9CE2AC9CE2AC9C20F09F9FA9F09F9FA9F09F9FA9F09F9FA9F09F9FA90AE2AC9CE2AC9CE2AC9CE2AC9CE2AC9C20E2AC9BE2AC9BE2AC9BE2AC9BE2AC9B0AE2AC9CE2AC9CE2AC9CE2AC9CE2AC9C20E2AC9BE2AC9BE2AC9BE2AC9BE2AC9B0AE2AC9CE2AC9CE2AC9CE2AC9CE2AC9C20E2AC9BE2AC9BE2AC9BE2AC9BE2AC9B0AE2AC9CE2AC9CE2AC9CE2AC9CE2AC9C20E2AC9BE2AC9BE2AC9BE2AC9BE2AC9B0AF09F9FA9F09F9FA9F09F9FA9F09F9FA9F09F9FA920E2AC9BE2AC9BE2AC9BE2AC9BE2AC9B0A0AE2AC9CF09F9FA9E2AC9CE2AC9CE2AC9C20E2AC9CE2AC9CE2AC9CE2AC9CE2AC9C0AE2AC9CE2AC9CE2AC9CE2AC9CF09F9FA820E2AC9CF09F9FA8E2AC9CE2AC9CE2AC9C0AE2AC9CE2AC9CE2AC9CE2AC9CE2AC9C20E2AC9CE2AC9CE2AC9CF09F9FA8E2AC9C0AE2AC9CF09F9FA9E2AC9CE2AC9CE2AC9C20F09F9FA8E2AC9CE2AC9CE2AC9CE2AC9C0AF09F9FA8F09F9FA9E2AC9CE2AC9CF09F9FA920E2AC9CE2AC9CF09F9FA8E2AC9CE2AC9C0AF09F9FA9F09F9FA9F09F9FA8E2AC9CF09F9FA920E2AC9CE2AC9CE2AC9CE2AC9CE2AC9C0AF09F9FA9F09F9FA9F09F9FA9F09F9FA9F09F9FA920E2AC9CE2AC9CE2AC9CE2AC9CE2AC9C0AE2AC9BE2AC9BE2AC9BE2AC9BE2AC9B20F09F9FA9F09F9FA9F09F9FA9F09F9FA9F09F9FA90A426172656C79206D61646520697486840269490120928484840C4E5344696374696F6E61727900958401690292849898265F5F6B494D4261736557726974696E67446972656374696F6E4174747269627574654E616D658692848484084E534E756D626572008484074E5356616C7565009584012A848401719FFF86928498981D5F5F6B494D4D657373616765506172744174747269627574654E616D658692849D9E9F9F00868699020B92849A9B0492849898165F5F6B494D4C696E6B4174747269627574654E616D658692848484054E5355524C0095840163009284989812687474703A2F2F71756F72646C652E636F6D868692A092A1928498981E5F5F6B494D4461746144657465637465644174747269627574654E616D6586928484840D4E534D757461626C6544617461008484064E534461746100959B812C0284065B353536635D62706C6973743030D4010203040506070C582476657273696F6E592461726368697665725424746F7058246F626A6563747312000186A05F100F4E534B657965644172636869766572D208090A0B5776657273696F6E5964642D726573756C74800B8001AC0D0E1C2425262C2D2E32363A55246E756C6CD70F101112131415161718191A1B1A524D535624636C6173735241525154515052535252564E8006800A8002800710018008D41D1E1F10202122235F10124E532E72616E676567616C2E6C656E6774685F10144E532E72616E676567616C2E6C6F636174696F6E5A4E532E7370656369616C8003800410048005100B1020D22728292A5A24636C6173736E616D655824636C6173736573574E5356616C7565A2292B584E534F626A6563745B71756F72646C652E636F6D5657656255524CD22F1030315A4E532E6F626A65637473A08009D2272833345E4E534D757461626C654172726179A333352B574E534172726179D2272837385F100F44445363616E6E6572526573756C74A2392B5F100F44445363616E6E6572526573756C74100100080011001A00240029003200370049004E005600600062006400710077008600890090009300950097009A009D009F00A100A300A500A700A900B200C700DE00E900EB00ED00EF00F100F300F500FA0105010E011601190122012E0135013A014501460148014D015C01600168016D017F018201940000000000000201000000000000003B0000000000000000000000000000019686929B929C86990181040186",
        "expected_text": "Daily Quordle 102\n9ğŸŸ¨ğŸŸ¨ğŸŸ¨ğŸŸ¨\n7ğŸŸ¨ğŸŸ¨ğŸŸ¨ğŸŸ¨\nquordle.com\nğŸˆâ¬œâ¬œâ¬œâ¬œ â¬œğŸ‰ğŸ‰â¬œâ¬œ\nâ¬œâ¬œğŸ‰â¬œâ¬œ ğŸˆâ¬œâ¬œâ¬œâ¬œ\nâ¬œâ¬œâ¬œâ¬œâ¬œ â¬œâ¬œâ¬œâ¬œğŸ‰\nâ¬œâ¬œâ¬œâ¬œâ¬œ ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰\nâ¬œâ¬œâ¬œâ¬œâ¬œ â¬›â¬›â¬›â¬›â¬›\nâ¬œâ¬œâ¬œâ¬œâ¬œ â¬›â¬›â¬›â¬›â¬›\nâ¬œâ¬œâ¬œâ¬œâ¬œ â¬›â¬›â¬›â¬›â¬›\nâ¬œâ¬œâ¬œâ¬œâ¬œ â¬›â¬›â¬›â¬›â¬›\nğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ â¬›â¬›â¬›â¬›â¬›\n\nâ¬œğŸ‰â¬œâ¬œâ¬œ â¬œâ¬œâ¬œâ¬œâ¬œ\nâ¬œâ¬œâ¬œâ¬œâ¬œ ğŸˆâ¬œâ¬œâ¬œâ¬œ\nâ¬œâ¬œâ¬œâ¬œâ¬œ â¬œâ¬œâ¬œğŸˆâ¬œ\nâ¬œğŸ‰â¬œâ¬œâ¬œ ğŸˆâ¬œâ¬œâ¬œâ¬œ\nğŸˆğŸ‰â¬œâ¬œğŸ‰ â¬œâ¬œğŸˆâ¬œâ¬œ\nğŸ‰ğŸ‰ğŸ‰ğŸˆğŸ‰ â¬œâ¬œâ¬œâ¬œâ¬œ\nğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ â¬œâ¬œâ¬œâ¬œâ¬œ\nâ¬›â¬›â¬›â¬›â¬› ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰\nBarely made it"
    },
    {
        "name": "question_message",
        "description": "Message with question marks and special characters",
        "hex_data": "040B73747265616D747970656481E803840140848484124E5341747472696275746564537472696E67008484084E534F626A656374008592848484084E53537472696E67019484012B7657686174E280997320796F757220666C696768743F3F2049E280996D20686572652074696C203733302E2049E280996C6C2074727920746F2067657420612073686F75746F757420616E642074656C6C207468652050696C6F74E280997320796F75206E656564206C6F7473206F6620626F6F7A65208684026949016E928484840C4E5344696374696F6E617279009484016901928496961D5F5F6B494D4D657373616765506172744174747269627574654E616D658692848484084E534E756D626572008484074E5356616C7565009484012A84999900868686",
        "expected_text": "What's your flight?? I'm here til 730. I'll try to get a shoutout and tell the Pilot's you need lots of booze"
    },
    {
        "name": "group_message",
        "description": "Message from a group chat",
        "hex_data": "040B73747265616D747970656481E803840140848484124E5341747472696275746564537472696E67008484084E534F626A656374008592848484084E53537472696E67019484012B374C6F7264204265636B65747420697320646566696E6974656C7920746865206163636F756E7420696E207468652067726F7570206C6F6C86840269490137928484840C4E5344696374696F6E617279009484016901928496961D5F5F6B494D4D657373616765506172744174747269627574654E616D658692848484084E534E756D626572008484074E5356616C7565009484012A84999900868686",
        "expected_text": "Lord Beckett is definitely the account in the group lol"
    }
]

def hex_to_binary(hex_string):
    """Convert hex string to binary data."""
    return bytes.fromhex(hex_string)

def create_fixtures():
    """Create test fixtures from the test cases."""
    fixtures_dir = Path("/Users/chrispatten/workspace/haven/hostagent/Tests/IMessagesTests/Fixtures")
    fixtures_dir.mkdir(exist_ok=True)
    
    for case in test_cases:
        # Create binary file
        binary_data = hex_to_binary(case["hex_data"])
        binary_file = fixtures_dir / f"{case['name']}.bin"
        with open(binary_file, 'wb') as f:
            f.write(binary_data)
        
        # Create metadata file
        metadata = {
            "name": case["name"],
            "description": case["description"],
            "expected_text": case["expected_text"],
            "binary_file": f"{case['name']}.bin",
            "size_bytes": len(binary_data)
        }
        
        metadata_file = fixtures_dir / f"{case['name']}.json"
        with open(metadata_file, 'w') as f:
            json.dump(metadata, f, indent=2)
        
        print(f"Created fixture: {case['name']} ({len(binary_data)} bytes)")

if __name__ == "__main__":
    create_fixtures()
